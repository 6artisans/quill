<!DOCTYPE html>
<html>
  <head>
    <title>A New Delta - Quill</title>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="language" content="english">
<meta name="viewport" content="width=device-width">

<meta name="description" content="Quill is a free, open source WYSIWYG editor built for the modern web. With its modular architecture and expressive API, it is completely customizable to fit any need.">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@quilljs">

<meta name="twitter:title" content="A New Delta - Quill">

<meta name="twitter:description" content="Quill is a free, open source WYSIWYG editor built for the modern web.">
<meta name="twitter:image" content="http://quilljs.com/assets/images/brand-asset.png">
<meta property="og:type" content="website">
<meta property="og:url" content="http://quilljs.com/blog/a-new-delta/">
<meta property="og:image" content="http://quilljs.com/assets/images/brand-asset.png">
<meta property="og:title" content="A New Delta - Quill">
<meta property="og:site_name" content="Quill">
<link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico" />
<link type="application/atom+xml" rel="alternate" href="https://quilljs.com/feed.xml" title="Quill - Your powerful, rich text editor" />
    <link rel="stylesheet" href="/assets/css/base.css">
    
    
      
      
    
    <link rel="stylesheet" href="/assets/css/styles.css">
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-19077541-2', 'auto');
  ga('send', 'pageview');
</script>
<script type="text/javascript">
  window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
  heap.load("1135832181");
</script>
  </head>
  <body>
    <header>
  <nav class="navbar-drop">
    <button class="navbar-close"></button>
    <ul>
      <li class="navbar-item">
        <a class="navbar-link" href="/docs/quickstart/">Documentation</a>
      </li>
      <li class="navbar-item">
        <a class="navbar-link" href="/guides/why-quill/">Guides</a>
      </li>
      <li class="navbar-item">
        <a class="navbar-link" href="/playground/">Playground</a>
      </li>
      <li class="navbar-item">
        <a class="navbar-link" href="/blog/">Blog</a>
      </li>
      <li class="navbar-item">
        <span class="github-button dark-bg">
  <a class="github-action" target="_blank" title="Star Quill on Github" href="https://github.com/quilljs/quill/">
    <svg viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.3 6.53 5.47 7.6.4.06.55-.18.55-.4 0-.18 0-.8 0-1.48-2.02.37-2.54-.5-2.7-.94-.1-.23-.48-.94-.82-1.13-.28-.15-.68-.52 0-.53.62 0 1.07.58 1.22.82.72 1.2 1.87.87 2.33.66.07-.52.28-.87.5-1.07-1.77-.2-3.63-.9-3.63-3.95 0-.87.3-1.6.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.2 2.2.83.64-.18 1.32-.27 2-.27.68 0 1.36.1 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.93.08 2.13.5.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.3.25.54.73.54 1.48 0 1.08 0 1.94 0 2.2 0 .22.15.47.55.4C13.7 14.52 16 11.52 16 8c0-4.42-3.58-8-8-8z"/></svg>
    <span>Star</span>
  </a>
  <a class="github-count" target="_blank" title="Quill Stargazers" href="https://github.com/quilljs/quill/stargazers">8,000</a>
</span>
      </li>
    </ul>
  </nav>
  <nav class="container">
    <ul class="navbar-list">
      <li class="navbar-item">
        <a class="navbar-link" href="/docs/quickstart/">Documentation</a>
      </li>
      <li class="navbar-item">
        <a class="navbar-link" href="/guides/why-quill/">Guides</a>
      </li>
      <li class="logo-item">
        <a class="logo" href="/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 942 559.9"><style type="text/css">.st0{fill:#1D1E30;}</style><circle cx="749" cy="125.5" r="25.7" class="st0"/><path d="M643.3 211.5c0 21.2 0 76.5 0 91.8 0 19.5-3.5 90.9-76.1 90.9-75.9 0-74.3-71.3-74.3-98.8 0-23.4 0-70.4 0-83.8h-39v94.1s-8.1 128.5 111.3 128.5c119.4 0 115.4-124.5 115.4-124.5v-98.2h-37.3zM816.5 45.2H855v378.5h-38.5zM504 472.7c-79.4 0-194.9-12-268.3-12.8-12.2 0-23 1.5-32.6 3.9l13-11.6c14.3-12.9 37.6-20.9 43.4-22 94.4-18.6 164.8-93.7 164.8-212.8C424.3 83.2 329.3 0 212.1 0S0 76.9 0 217.3c0 126.8 84.9 208 193.1 216.5 0 0 5.7.1 6.4 3.6.6 3.1-4.8 7.6-4.8 7.6l-64.4 59.6 12.4 13.4 23.8-21.3c13.3-10.6 35.1-23.6 62.1-23.6 89.3 0 188.2 89.1 280.1 86.9 134.4-3.2 165.7-93 169.1-104.6.2-.4-55.6 17.3-173.8 17.3zM39.4 217.3c0-114.3 77.3-177 172.8-177 95.4 0 172.8 67.7 172.8 177 0 112.6-77.3 177-172.8 177-95.5-.1-172.8-67.8-172.8-177zM903.5 45.2H942v378.5h-38.5zM729.5 211.1H768v212.5h-38.5z" class="st0"/></svg></a>
      </li>
      <li class="navbar-item">
        <a class="navbar-link" href="/playground/">Playground</a>
      </li>
      <li class="active navbar-item">
        <a class="navbar-link" href="/blog/">Blog</a>
      </li>
      <li class="download-item">
        <a class="action" href="/docs/download/">Download</a>
      </li>
    </ul>
  </nav>
  <button class="navbar-open">
    <span></span>
    <span></span>
    <span></span>
  </button>
</header>
    
    
      
        
        
          
          
            <div id="blog-container" class="container">
  <div class="post">
    <h1>A New Delta</h1>
    <div class="post-meta">
      <time>29 Sep 2014</time>
      <span> - <a href="https://twitter.com/jhchen" title="Jason Chen">Jason Chen</a></span>
    </div>
    <p>Part of providing a complete API in Quill is providing events for when and what changes occur in the editor. Those changes are currently represented by a <a href="/guides/working-with-deltas/">Delta</a> object, which aims to be intuitive, human-readable, and expressive for any change or document that might need to represented. Over the past few weeks I’ve been working on a new format that better fulfills those goals and addresses the challenges in the current format.</p>

<p>Documentation for the new Delta format can be found in its own <a href="https://github.com/ottypes/rich-text">Github repository</a> but I will go over some of the rationale behind some of the changes in this post.</p>

<!-- more -->

<h3 id="reduced-complexity">Reduced Complexity</h3>

<p>When the Delta format was originally designed, it had ambitious goals of being general purpose and being able to represent any kind of document. The new format reduces the scope to just rich text documents, allowing for a much tighter implementation<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>.</p>

<p>Quill is not specifically built to be a collaborative editor but the ability to be used as one is a good benchmark of the API. The new Delta format maintains this capability and fulfills the specifications of an <a href="https://github.com/ottypes/docs">ottype</a>, making it compatible with <a href="https://github.com/share/ShareJS">ShareJS</a>.</p>

<h3 id="explicit-deletes">Explicit Deletes</h3>

<p>In the current Delta format, a delete operation is implied by a lack of a retain operation. Basically everything is deleted unless you say it should be kept. This has some nice properties from an implementation perspective<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> but was probably the largest source of confusion for users trying to work with Deltas and challenged the human-readability goal. It is very difficult to keep track of indexes to figure out what was not accounted for, to figure out what should be deleted.</p>

<p>The new format has an explicit delete operation and by default everything is kept. Here’s a comparison of the two formats both representing removing the ‘b’ in ‘abc’.</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">oldFormat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">startLength</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="na">endLength</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="na">ops</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">start</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">end</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">start</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">end</span><span class="p">:</span> <span class="mi">3</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">newFormat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">ops</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">retain</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">delete</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>
</code></pre>
</div>

<p>A side effect of having explicit deletes and defaulting to keeping text is that in practice the representation for new Deltas will usually be smaller.</p>

<h3 id="embed-support">Embed Support</h3>

<p>The new Delta format provides native support for embeds, which can be used to represent images, video, etc. There is no support for this in the current format and implementation is hackily achieved by representing an ‘!’ with a image key in the attributes (which will break when video support is added).</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">oldFormat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">startLength</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">endLength</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">ops</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">text</span><span class="p">:</span> <span class="s1">'!'</span><span class="p">,</span>
    <span class="na">attributes</span><span class="p">:</span> <span class="p">{</span> <span class="na">image</span><span class="p">:</span> <span class="s1">'https://octodex.github.com/images/labtocat.png'</span> <span class="p">}</span>
  <span class="p">}]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">newFormat</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">ops</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">insert</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">attributes</span><span class="p">:</span> <span class="p">{</span> <span class="na">image</span><span class="p">:</span> <span class="s1">'https://octodex.github.com/images/labtocat.png'</span> <span class="p">}</span>
  <span class="p">}]</span>
<span class="p">};</span>
</code></pre>
</div>

<h3 id="going-forward">Going Forward</h3>

<p>This new format will be the finalized representation for changes and state in Quill going forward and is one of the major steps toward a 1.0 release (a topic for another post).</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Currently 28658 vs 9507 lines of code (though in practice is less relevant due to minification and gzip).&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Minimizes number of operations to support, and easy to calculate the length of text of the resulting document which is useful for sanity checks.&nbsp;<a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>
</div>
          
        
      
    
    <footer>
  <div class="container">
    <div class="logo row"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 942 559.9"><style type="text/css">.st0{fill:#1D1E30;}</style><circle cx="749" cy="125.5" r="25.7" class="st0"/><path d="M643.3 211.5c0 21.2 0 76.5 0 91.8 0 19.5-3.5 90.9-76.1 90.9-75.9 0-74.3-71.3-74.3-98.8 0-23.4 0-70.4 0-83.8h-39v94.1s-8.1 128.5 111.3 128.5c119.4 0 115.4-124.5 115.4-124.5v-98.2h-37.3zM816.5 45.2H855v378.5h-38.5zM504 472.7c-79.4 0-194.9-12-268.3-12.8-12.2 0-23 1.5-32.6 3.9l13-11.6c14.3-12.9 37.6-20.9 43.4-22 94.4-18.6 164.8-93.7 164.8-212.8C424.3 83.2 329.3 0 212.1 0S0 76.9 0 217.3c0 126.8 84.9 208 193.1 216.5 0 0 5.7.1 6.4 3.6.6 3.1-4.8 7.6-4.8 7.6l-64.4 59.6 12.4 13.4 23.8-21.3c13.3-10.6 35.1-23.6 62.1-23.6 89.3 0 188.2 89.1 280.1 86.9 134.4-3.2 165.7-93 169.1-104.6.2-.4-55.6 17.3-173.8 17.3zM39.4 217.3c0-114.3 77.3-177 172.8-177 95.4 0 172.8 67.7 172.8 177 0 112.6-77.3 177-172.8 177-95.5-.1-172.8-67.8-172.8-177zM903.5 45.2H942v378.5h-38.5zM729.5 211.1H768v212.5h-38.5z" class="st0"/></svg></div>
    <h1>Your powerful, rich text editor.</h1>
    <div class="actions row">
      <a href="/docs/" class="action documentation">Documentation</a>
      <a href="/docs/download/" class="action">
        Download v
      </a>
    </div>
    <div class="users row">
      <h3>Trusted By</h3>
    </div>
  </div>
</footer>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    
    
      
      
    
    <script type="text/javascript">
    $(document).ready(function() {
      $('.navbar-open').click(function() {
        $('.navbar-drop').addClass('active');
      });
      $('.navbar-close').click(function() {
        $('.navbar-drop').removeClass('active');
      });

      var counts = $('.github-count');
      if (counts.length > 0) {
        $.getJSON('https://api.github.com/search/repositories?q=quill+user:quilljs+repo:quill&sort=stars&order=desc', function(data) {
          if (data.items && data.items[0].full_name === 'quilljs/quill') {
            counts.text(data.items[0].stargazers_count.toLocaleString());
          }
        });
      }
    });
    </script>
    </div>
  </body>
</html>
